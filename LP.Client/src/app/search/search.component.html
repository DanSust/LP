<div class="gallery-wrapper">
  <!-- üî• –ü–õ–ê–í–ê–Æ–©–ê–Ø –ò–ö–û–ù–ö–ê –§–ò–õ–¨–¢–†–ê -->
  @if (!showFilters) {
  <div class="status-bar">
    <div class="status-content">
      <div class="results-count">
        <mat-icon>people</mat-icon>
        <span>–ù–∞–π–¥–µ–Ω–æ: {{allImages.length}} {{getPeopleWord(allImages.length)}}</span>
      </div>
      <button class="filter-toggle-btn" (click)="toggleFilters()" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã">
        <mat-icon>filter_list</mat-icon>
        <span>–§–∏–ª—å—Ç—Ä—ã</span>
      </button>
    </div>
  </div>
  }

  <!-- üî• –§–ò–õ–¨–¢–†–´ -->
  @if (showFilters) {
  <div class="filters-container">
    <!-- üåç –í–´–ë–û–† –õ–û–ö–ê–¶–ò–ò -->
    <div class="filter-group location-group">
      <!--<div class="location-header">
        @if (useGeolocation && currentPosition) {
        <div class="geo-status">
          <mat-icon class="success">check_circle</mat-icon>
          <span>{{ currentPosition.latitude.toFixed(4) }}, {{ currentPosition.longitude.toFixed(4) }}</span>
        </div>
        }
      </div>-->

      <!-- –û—à–∏–±–∫–∞ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ -->
      @if (locationError) {
      <div class="location-error">
        <mat-icon>error</mat-icon>
        <span>{{ locationError }}</span>
        <button mat-button color="accent" (click)="requestGeolocation()">–ü–æ–≤—Ç–æ—Ä–∏—Ç—å</button>
      </div>
      }

      <!-- –í—ã–±–æ—Ä –≥–æ—Ä–æ–¥–∞ —Å –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ–º -->
      <mat-form-field appearance="fill" class="city-select">
        @if (useGeolocation && currentPosition) {
        <mat-label>{{ currentPosition.latitude.toFixed(4) }}, {{ currentPosition.longitude.toFixed(4) }}</mat-label>
        } @else {
        <mat-label>–ì–æ—Ä–æ–¥</mat-label>
        }
        <input type="text"
               placeholder="–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥"
               aria-label="–ì–æ—Ä–æ–¥"
               matInput
               [formControl]="cityControl"
               [matAutocomplete]="auto">
        <button mat-icon-button matSuffix
                (click)="$event.stopPropagation(); onGeolocationClick()"
                [disabled]="isLocating"
                class="geo-btn"
                title="–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–æ—ë –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ">
          @if (isLocating) {
          <mat-spinner diameter="18"></mat-spinner>
          } @else {
          <mat-icon [class.active]="useGeolocation">my_location</mat-icon>
          }
        </button>
        <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayCityFn" (optionSelected)="onCitySelected($event)">
          @for (city of filteredCities | async; track city.id) {
          <mat-option [value]="city">{{ city.name }}</mat-option>
          }
        </mat-autocomplete>
      </mat-form-field>

      <!-- –†–∞–¥–∏—É—Å –ø–æ–∏—Å–∫–∞ (—Ç–æ–ª—å–∫–æ –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏) -->
      @if (useGeolocation && currentPosition) {
      <div class="radius-filter">
        <label class="filter-label">–†–∞–¥–∏—É—Å: {{radiusKm}} –∫–º</label>
        <mat-slider min="1" max="500" step="5" [discrete]="1" style="min-width: 100%" >
          <input matSliderThumb [(ngModel)]="radiusKm" (dragEnd)="onFilterChange()">
        </mat-slider>
      </div>
      }
    </div>

    <!-- –§–∏–ª—å—Ç—Ä –ø–æ –≤–æ–∑—Ä–∞—Å—Ç—É -->
    <div class="filter-group">
      <label class="filter-label">–í–æ–∑—Ä–∞—Å—Ç: {{ageMin}} - {{ageMax}} –ª–µ—Ç</label>
      <mat-slider min="18" max="80" [discrete]="1">
        <input matSliderStartThumb [(ngModel)]="ageMin" (input)="onFilterChange()">
        <input matSliderEndThumb [(ngModel)]="ageMax" (input)="onFilterChange()">
      </mat-slider>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è -->
    <button class="apply-filters-btn" (click)="applyFilters()" color="accent">
      <mat-icon>search</mat-icon>
      –ò—Å–∫–∞—Ç—å
    </button>
  </div>
  }
  <!-- üî• –ì–ê–õ–ï–†–ï–Ø -->
  <div class="gallery-search-container" #galleryContainer>
    @for (image of allImages; track image.userId) {
    <div class="gallery-item">
      <div class="image-wrapper">
        <img [src]="image.imageUrl" routerLink="/vote/{{image.userId}}" />
      </div>
      <div class="photo-info">
        <span class="photo-name">{{ image.name }}</span>
        <span class="photo-age">{{ image.age }} –ª–µ—Ç</span>
        @if (image.distance) {
        <span class="photo-distance">
          <mat-icon>place</mat-icon>
          {{ formatDistance(image.distance) }}
        </span>
        }
        <div class="interests-tags">
          @for (interest of image.interests; track interest) {
          <span class="interest-tag">{{interest}}</span>
          }
        </div>
      </div>
    </div>
    }

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö -->
    @if (isLoadingMore) {
    <div class="loading-more">
      <mat-spinner diameter="30"></mat-spinner>
      <span>–ó–∞–≥—Ä—É–∑–∫–∞...</span>
    </div>
    }
  </div>

  <ng-template #loadingTemplate>
    <!--<div class="gallery-container">
      <div class="gallery-item loading"><div class="skeleton"></div></div>
      <div class="gallery-item loading"><div class="skeleton"></div></div>
      <div class="gallery-item loading"><div class="skeleton"></div></div>
      <div class="gallery-item loading"><div class="skeleton"></div></div>
    </div>-->
  </ng-template>
</div>
