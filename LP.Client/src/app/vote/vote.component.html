<div class="card-stack">

  <!-- –ù–µ—Ç –ø—Ä–æ—Ñ–∏–ª–µ–π -->
  @if (profiles().length === 0 && !exitingProfile()) {
  <div class="no-profiles">
    <h2>–ü–æ–∫–∞ –Ω–µ—Ç –Ω–æ–≤—ã—Ö –ª—é–¥–µ–π</h2>
    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</p>
  </div>
  }

  <!-- === –°–õ–ï–î–£–Æ–©–ò–ô –ü–†–û–§–ò–õ–¨ (–ø–æ–¥–ª–æ–∂–∫–∞) === -->
  @if (profiles()[1]; as nextProfile) {
  <div class="card next-card" [style.z-index]="1">
    <div class="card-content">
      <div class="photo-wrapper">
        @if (nextProfile.photoUrls && nextProfile.photoUrls.length > 0) {
        <img [src]="nextProfile.photoUrls[0].path"
             [alt]="nextProfile.name"
             class="card-photo" />
        } @else {
        <div class="no-photo">–ù–µ—Ç —Ñ–æ—Ç–æ</div>
        }
      </div>
    </div>
  </div>
  }

  <!-- === –¢–ï–ö–£–©–ò–ô –ü–†–û–§–ò–õ–¨ (–∞–∫—Ç–∏–≤–Ω—ã–π –¥–ª—è —Å–≤–∞–π–ø–∞) === -->
  @if (profiles()[0]; as profile) {
  <div class="card active-card"
       [style.z-index]="10"
       [class.dragging]="isDragging()">
    <div class="card-content">

      <div class="photo-wrapper" #activePhotoContainer
           [class.fullscreen]="isFullscreen()"
           [style.transform]="getCurrentTransform()"
           [style.transition]="isDragging() ? 'none' : 'transform 0.3s ease-out'"
           (click)="onPhotoClick($event)">

        <!-- –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å —Ç–æ–ª—å–∫–æ –≤ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ -->
        @if (isFullscreen()) {
        <button class="close-btn" (click)="toggleFullscreen()" title="–ó–∞–∫—Ä—ã—Ç—å">
          <mat-icon>close</mat-icon>
        </button>
        } @else {
        <!-- –ò–ú–Ø –ò –í–û–ó–†–ê–°–¢ –í –ü–†–ê–í–û–ú –í–ï–†–•–ù–ï–ú –£–ì–õ–£ -->
        <div class="profile-header-overlay">
          <h3>{{ profile.name }}, {{ profile.age }}</h3>
        </div>
        }
        @if (profile.photoUrls && profile.photoUrls.length > 0) {
        <img [src]="profile.photoUrls[currentPhotoIndex()].path"
             [alt]="profile.name"
             class="card-photo"
             (load)="onImageLoad()" />
        } @else {
        <div class="no-photo">–ù–µ—Ç —Ñ–æ—Ç–æ</div>
        }

        <!-- –°—Ç—Ä–µ–ª–∫–∏ -->
        @if (profile.photoUrls && profile.photoUrls.length > 1) {
        <button class="photo-arrow arrow-left"
                (click)="prevPhoto()"
                [disabled]="isAnimating()">
          ‚Äπ
        </button>
        <button class="photo-arrow arrow-right"
                (click)="nextPhoto()"
                [disabled]="isAnimating()">
          ‚Ä∫
        </button>

        <div class="photo-indicators">
          @for (url of profile.photoUrls; track $index) {
          <span class="photo-indicator" [class.active]="$index === currentPhotoIndex()"></span>
          }
        </div>
        }

        <!-- –ö–Ω–æ–ø–∫–∏ -->

        <div class="card-actions">
          <button class="action-btn dislike-btn"
                  (click)="onDislikeClick(); $event.stopPropagation()"
                  [disabled]="isAnimating()">
            ‚úï
          </button>
          <button class="action-btn more-btn"
                  (click)="onChatClick(profile.id); $event.stopPropagation()">
            ‚ãØ
          </button>
          <button class="action-btn like-btn"
                  (click)="onLikeClick(); $event.stopPropagation()"
                  [disabled]="isAnimating()">
            ‚ù§Ô∏è
          </button>
          <!--<button class="action-btn favorite-btn"
                      (click)="onFavoriteClick(profile.id); $event.stopPropagation()"
                      [disabled]="isAnimating()">‚≠ê
          </button>-->
        </div>
         @if (cameFromSearch() && !isFullscreen()) {
        <button class="back-btn" (click)="goBackToSearch()" title="–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–∏—Å–∫—É">
          <mat-icon>reply</mat-icon>
        </button>
        }

      </div>

      <!-- –î–µ—Ç–∞–ª–∏ -->
      <div class="details-wrapper">
        <div class="profile-details">
          <!--<h3>{{ profile.name }}, {{ profile.age }}</h3>-->

          <div class="detail-item">
            <span class="detail-label">üìç {{ profile.city || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
          </div>

          @if (profile.interests && profile.interests.length > 0) {
          <div class="detail-item">
            
            <span class="detail-value">
              <span class="detail-label">üéØ</span>  
              
              @for (interest of profile.interests; track interest.id; let last = $last) {
              <span class="interest-tag">
                <img [src]="'assets' + interest.path" [alt]="interest.name" class="interest-icon" />
                {{ interest.name }}
              </span>
              
              }
            </span>
          </div>
          }

          <div class="detail-item">
            <span class="detail-label">üë§ {{ profile.height || '' }} —Å–º. {{ profile.weight || '' }} –∫–≥.</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">‚ôà {{ profile.zodiac || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
          </div>

          <div class="detail-item">
            <span class="detail-label">üíº {{ profile.description || '–ù–µ —É–∫–∞–∑–∞–Ω–æ' }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- === –£–õ–ï–¢–ê–Æ–©–ò–ô –ü–†–û–§–ò–õ–¨ (—Å–∞–º—ã–π –≤–µ—Ä—Ö–Ω–∏–π —Å–ª–æ–π) === -->
  @if (exitingProfile(); as exit) {
  <div class="card exit-card" [style.z-index]="20">
    <div class="card-content">

      <!-- –û–≤–µ—Ä–ª–µ–∏ -->
      <div class="swipe-overlay like-overlay"
           [style.opacity]="exit.direction === 'right' ? getOverlayOpacity() : 0">

      </div>
      <div class="swipe-overlay dislike-overlay"
           [style.opacity]="exit.direction === 'left' ? getOverlayOpacity() : 0">

      </div>

      <div class="photo-wrapper">
        <img [src]="exit.photoUrl"
             [alt]="exit.name"
             class="card-photo exit-photo"
             [style.transform]="getExitTransform()"
             [style.transition]="'transform 300ms ease-out'" />
      </div>

      <!-- –ó–∞–≥–ª—É—à–∫–∞ –∫–Ω–æ–ø–æ–∫ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è layout -->
      <div class="card-actions dummy-actions">
        <button class="action-btn" disabled>‚úï</button>
        <button class="action-btn" disabled>‚ãØ</button>
        <button class="action-btn" disabled>‚ù§Ô∏è</button>
        <button class="action-btn" disabled>‚≠ê</button>
      </div>
    </div>
  </div>
  }

</div>
